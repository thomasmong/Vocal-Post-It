${ProjName}:
SPI_Wakeup_Slave


Intended purpose:
To demonstrate low power mode wakeup of a slave lpc8xx, by its on-chip SPI,
using externally generated SPI activity by a master lpc8xx. 
Current consumption can be measured on the slave, if desired.

Typical low power mode currents at room temperature for a MAX slave board:
* If TARGET_RX on the MAX board is connected via solder-jumper to the LPC11U35, 
  the currents you measure may be higher than the following, which were measured
  at room temperature on one MAX board with the solder-jumper removed.
* Sleep mode        1.08 mA
* Deep Sleep mode   .208 mA
* Power-down mode   1.75 uA


Functional description:
* The slave project is intended to run concurrently with project Example_SPI_Wakeup_Master, 
  using two interconnected lpc8xx Max boards, one each for master and slave.
  
* For the master project, user input/output is through the debug UART, which is configured in
  Serial.c. Connect a terminal emulator (set to 9600/8/N/1) to the appropriate VCOM or USB
  COM port.
  
* The slave project communicates with the master via SPI.
  
* When the master project runs, the user is prompted to enter '0', '1', or '2'
  to put the slave into Sleep, Deep-sleep, or Power-down mode, respectively.

* The slave board's target enters the low power mode selected, and is awakened by an SPI transfer
  generated by the master board, when the user types 'Esc' after a prompt.

* 3 LEDs are configured to verify if the Slave actually entered the low power mode.
  The three LEDs (Green, Red and Blue) are turned ON at the beginning of the test.

  When Slave enters Sleep mode ('0' selected at Master side), Green LED goes off.
  When Slave enters Deep-sleep ('1' selected at Master side), Red LED goes off.
  When Slave enters Power-down mode ('2' selected at Master side), Blue LED goes off.
  
External connections:
* The master and slave boards must be connected as per the pins defined in the main c files
  and SWM settings, as described below:

  // SPI0 (master board)       ... connect to ... SPI0 (slave board)
  // SPI0_SCK on master board  ... connect to ... SPI0_SCK on slave board
  // SPI0_MOSI on master board ... connect to ... SPI0_MOSI on slave board
  // SPI0_SSEL on master board ... connect to ... SPI0_SSEL on slave board



Program Flow (slave board):
* This example runs from the 12MHz FRO with a 12 MHz. main clock.


* main() routine
  1. Clocks are enabled, analog blocks are disabled, internal pull-ups and pull-downs are disabled, GPIOs are made outputs driving '1'. 
  
  2. The SWM is configured for SPI1 SCK, MOSI, and SSEL.
  
  3. SPI1 and its clocking are configured for 115200 bps, slave mode, 8 data bits.
  
  4. SPI1 RXREADY interrupt is enabled, SPI0 interrupt is enabled as wakeup source, and code execution enters the main while(1) loop.
  
  5. When code execution receives handshake from the ISR, the requested low power mode is entered.
  
  6. The next SPI0 data received will wake up the lpc8xx, and the process repeats.
 


  
This example runs from Flash. 


To run this code:
  1. Build
  2. Program to flash
  3. Reset the master board
  4. Reset the slave board

Note: It may be necessary to power-cycle the board in order to regain control of the reset button after programming.




